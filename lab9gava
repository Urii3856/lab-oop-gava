import java.io.*;
import java.util.Arrays;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Enumeration;
import java.util.List;
import java.util.Random;

public class Main {
    public static void main(String[] args) throws IOException {

        final int N = 15; // Розмірність масиву
        final int M = 2;  // Кількість потоків для об'єднання
        final int A = 15; // Мінімальне значення
        final int B = 30; // Максимальне значення

        System.out.println("N = " + N + ", M = " + M + ", Діапазон: [" + A + ", " + B + "]\n");

        // 1. Розподіл N на M частин
        int baseCount = N / M;
        int remainder = N % M;

        // Список для зберігання M окремих потоків вводу
        List<InputStream> inputStreams = new ArrayList<>();

        System.out.println("Етап 1: Генерація даних та створення M = " + M + " потоків вводу:");

        // 2. Генерація даних та створення M окремих потоків вводу
        for (int i = 0; i < M; i++) {
            int partSize = baseCount + (i == M - 1 ? remainder : 0);

            // Створення та заповнення частини масиву
            int[] partArray = generateRandomArray(partSize, A, B);
            System.out.println("  Потік " + (i + 1) + " (розмір " + partSize + "): " + Arrays.toString(partArray).substring(0, Math.min(20, Arrays.toString(partArray).length())) + "...");

            // Перетворення int[] на потік байтів для I/O потоку
            ByteArrayOutputStream baos = new ByteArrayOutputStream();
            DataOutputStream dos = new DataOutputStream(baos);

            for (int val : partArray) {
                dos.writeInt(val);
            }
            dos.flush();

            // Створення потоку вводу з отриманого масиву байтів
            ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());
            inputStreams.add(bais);
        }

        System.out.println("\nЕтап 2: Об'єднання M потоків в один SequenceInputStream.");

        // 3. Об'єднання потоків за допомогою SequenceInputStream
        Enumeration<InputStream> en = Collections.enumeration(inputStreams);

        try (SequenceInputStream sequenceStream = new SequenceInputStream(en);
             DataInputStream dis = new DataInputStream(sequenceStream)) {

            System.out.println("Етап 3: Зчитування N = " + N + " елементів з об'єднаного потоку.");

            int[] finalArray = new int[N];
            int readCount = 0;

            // 4. Зчитування даних з об'єднаного потоку
            for (int i = 0; i < N; i++) {
                try {
                    finalArray[i] = dis.readInt();
                    readCount++;
                } catch (EOFException e) {
                    break;
                }
            }

            System.out.println("\n--- Результат ---");
            System.out.println("Зчитано елементів: " + readCount);
            System.out.println("✅ Фінальний об'єднаний масив (N=" + N + "):");
            System.out.println(Arrays.toString(finalArray));

        } catch (IOException e) {
            System.err.println("Помилка I/O: " + e.getMessage());
        }
    }


    private static int[] generateRandomArray(int size, int min, int max) {
        int[] array = new int[size];
        Random random = new Random();
        for (int i = 0; i < size; i++) {
            array[i] = random.nextInt(max - min + 1) + min;
        }
        return array;
    }
}
